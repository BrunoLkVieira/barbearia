{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funcionários - {{ barbershop.name }}</title>
    <link rel="shortcut icon" href="{% static 'geral/img/logo.ico' %}" type="image/x-icon">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    {# --- Estilos locais (mantidos) --- #}
    <link rel="stylesheet" href="{% static 'geral/css/desktop/style.css' %}">
    <link rel="stylesheet" href="{% static 'barbershop/css/desktop/employee.css' %}">
    <link rel="stylesheet" href="{% static 'barbershop/css/desktop/modals/newEmployee.css' %}">
    <link rel="stylesheet" href="{% static 'geral/css/mobile/style.css' %}">
    <link rel="stylesheet" href="{% static 'barbershop/css/mobile/employee.css' %}">
    <link rel="stylesheet" href="{% static 'barbershop/css/mobile/modals/newEmployee.css' %}">
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">
                {% if barbershop.logo %}
                    <img src="{{ barbershop.logo.url }}" alt="logo do sistema" class="logo-image">
                {% else %}
                    <img src="https://i.ibb.co/G3WqN7N1/logo-barbearia-Photoroom.png" alt="logo do sistema" class="logo-image">
                {% endif %}
            </div>
            <div class="logo-content">
                <h1>{{ barbershop.name }}</h1>
                <p>Sistema de agendamento profissional</p>
            </div>
        </div>
    </header>
    
    <div class="nav-bar">
        <div class="stats">
            <div class="unit-filter">
                <select>
                    {% for unit in units %}
                        <option>{{ unit.name }}</option>
                    {% endfor %}
                    <option>Geral</option>
                </select>
            </div>
            <div class="stat-box">
                <div class="stat-value">0</div>
                <div class="stat-label">Funcionários</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-users-cog"></i> Gerenciamento de Funcionários
                </div>
                <button class="add-employee-btn" onclick="openEmployeeModal()">
                    <i class="fas fa-plus"></i> Novo Funcionário
                </button>
            </div>
            
            <!-- Tabela desktop -->
            <table class="employees-table">
                <thead>
                    <tr>
                        <th>Funcionário</th>
                        <th>Unidade</th>
                        <th>Status</th>
                        <th>Celular</th>
                        <th>Ações</th>
                    </tr>
                </thead>

                <tbody>
                    {% for emp in employees %}
                        <tr>
                            <td>
                                <div class="employee-name">
                                    <div class="employee-avatar">
                                        {{ emp.user.name|slice:":1" }}{{ emp.user.last_name|slice:":1" }}
                                    </div>
                                    <div>{{ emp.user.name }} {{ emp.user.last_name }}</div>
                                </div>
                            </td>
                            <td>{{ emp.unit.name }}</td>
                            <td>
                                {% if emp.user.is_active %}
                                    <span class="employee-type type-barber">Ativo</span>
                                {% else %}
                                    <span class="employee-type type-cashier">Inativo</span>
                                {% endif %}
                            </td>
                            <td>{{ emp.user.phone|default:"---" }}</td>
                            <td>
                                <div class="employee-actions">
                                    <form method="POST" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="employee_id" value="{{ emp.id }}">
                                        <input type="hidden" name="action" value="edit">
                                        <button type="submit" class="action-btn edit-btn">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </form>
                                    <form method="POST" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="employee_id" value="{{ emp.id }}">
                                        <input type="hidden" name="action" value="delete">
                                        <button type="submit" class="action-btn delete-btn">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" style="text-align:center;">Nenhum funcionário cadastrado.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <footer>
        <div class="total-display">
            <div class="footer-first-row">
                Total de funcionários: <strong>{{ employees.count }}</strong>
            </div>
            <div class="footer-second-row">
                Ativos: <strong>{{ employees|dictsort:"user.is_active"|length }}</strong>
            </div>
        </div>
    </footer>

    <!-- Modal de Funcionário -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="action" value="create">
                <div class="modal-header">
                    <h2 id="modalTitle"><i class="fas fa-user-plus"></i> Novo Funcionário</h2>
                    <button class="close-btn" onclick="closeEmployeeModal()" type="button">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="employeeCPF">CPF</label>
                        <input type="text" name="cpf" id="employeeCPF" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="employeeName">Nome</label>
                        <input type="text" name="name" id="employeeName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="employeeLastName">Sobrenome</label>
                        <input type="text" name="last_name" id="employeeLastName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="employeeEmail">Email</label>
                        <input type="email" name="email" id="employeeEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="employeePhone">Telefone</label>
                        <input type="tel" name="phone" id="employeePhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="employeeUnit">Unidade</label>
                        <select name="unit_id" id="employeeUnit" class="form-select" required>
                            {% for unit in units %}
                                <option value="{{ unit.id }}">{{ unit.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                
                    <!-- Configurações de funcionário -->
                    <div class="form-group">
                        <label><input type="checkbox" name="commission_percentage"> Comissão?</label>
                    </div>
                    <div class="form-group">
                        <label for="serviceCommission">Comissão Serviço (%)</label>
                        <input type="number" step="0.01" name="service_commission_percentage" id="serviceCommission" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="productCommission">Comissão Produto (%)</label>
                        <input type="number" step="0.01" name="product_commission_percentage" id="productCommission" class="form-control">
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" name="can_manage_cashbox"> Pode Gerenciar Caixa</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" name="can_register_sell"> Pode Registrar Venda</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" name="can_create_appointments"> Pode Criar Agendamentos</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" name="system_access"> Acesso ao Sistema</label>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-outline" type="button" onclick="closeEmployeeModal()">Cancelar</button>
                    <button class="btn btn-primary" type="submit">
                        <i class="fas fa-save"></i> Salvar Funcionário
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="{% static 'geral/js/script.js' %}"></script>
    <script src="{% static 'barbershop/js/employee.js' %}"></script>
</body>
</html>
